from pyrogram import Client, filters
import requests
from ANNIEMUSIC import app

# Function to retrieve husbando information from the API
def get_husbando_info(api_token):
    url = "https://waifu.it/api/v4/husbando"
    headers = {
        "Authorization": api_token
    }
    try:
        response = requests.get(url, headers=headers)
        response.raise_for_status()
        data = response.json()
        return data
    except requests.exceptions.RequestException as e:
        print(f"An error occurred while making the request: {e}")
        return None
    except Exception as e:
        print(f"An unexpected error occurred: {str(e)}")
        return None

# Command handler for /husbando command
@app.on_message(filters.command("husbando") & ~filters.forwarded & ~filters.via_bot)
def husbando_command(client, message):
    try:
        # Replace "Your-API-Token" with your actual API token obtained from Kohai Bot
        api_token = "Your-API-Token"
        husbando_data = get_husbando_info(api_token)

        if husbando_data:
            # Format and send husbando information
            msg = f"**Husbando Info**:\n\n"
            msg += f"**_id:** {husbando_data.get('_id')}\n"
            msg += f"**Name:** {husbando_data.get('name')}\n"
            msg += f"**Image:** {husbando_data.get('image')}\n"
            msg += f"**Media:** {husbando_data.get('media')}\n"
            msg += f"**Description:** {husbando_data.get('description')}\n"
            msg += f"**Age:** {husbando_data.get('age')}\n"
            msg += f"**Gender:** {husbando_data.get('gender')}\n"
            msg += f"**Blood Type:** {husbando_data.get('bloodType')}\n"
            msg += f"**Date of Birth:** {husbando_data.get('dateOfBirth')}\n"
            msg += "**Media Nodes:**\n"
            for node in husbando_data.get('media', {}).get('nodes', []):
                msg += f"- **Title:** {node.get('title')}\n"
                msg += f"  **Type:** {node.get('type')}\n"
                msg += f"  **Format:** {node.get('format')}\n"
            message.reply_text(msg, parse_mode='markdown')
        else:
            message.reply_text("Couldn't retrieve the husbando data. Please try again.")
        
    except Exception as e:
        message.reply_text(f"An unexpected error occurred: {str(e)}")
